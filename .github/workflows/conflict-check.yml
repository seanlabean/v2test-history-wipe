name: "Conflict Guard"
on: [pull_request]

jobs:
  check-markers:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Robust Conflict Check
        run: |
          ERRORS=0

          # Check 1: Look for the breadcrumb file created by the script
          if [ -f .migration_conflict ]; then
            echo "❌ ERROR: This branch was flagged during migration for a complex conflict (e.g. Deleted vs Modified)."
            cat .migration_conflict
            ERRORS=1
          fi

          # Check 2: Look for standard markers
          if grep -rnE "<<<<<<<|=======|>>>>>>>" . --exclude-dir=.git --exclude=.migration_conflict; then
            echo "❌ ERROR: Standard merge conflict markers found."
            ERRORS=1
          fi

          if [ $ERRORS -eq 1 ]; then
            exit 1
          else
            echo "✅ No conflicts detected."
          fi
